Options +MultiViews

ErrorDocument 404 /pages/404.html

RewriteEngine on
<FilesMatch "(error_log|php\.ini|index\.php\.swp)$">
  Order deny,allow
  Deny from all
</FilesMatch>

<FilesMatch ".(eot|ttf|otf|woff)">
    Header set Access-Control-Allow-Origin "*"
</FilesMatch>

# Redirect for grakn.ai/discuss
RewriteCond %{HTTP_HOST} ^grakn\.ai$ [OR]
RewriteCond %{HTTP_HOST} ^www\.grakn\.ai$
RewriteRule ^discuss$ "https://discuss.grakn.ai/" [R=301,L]

# Redirect www to non-www
RewriteCond %{HTTP_HOST} ^www\.grakn\.ai$
RewriteRule ^(.*)$ "https://grakn.ai/$1" [R=301,L]

# Redirect to https
RewriteCond %{HTTP_HOST} ^grakn\.ai [NC]
RewriteCond %{SERVER_PORT} 80
RewriteRule ^(.*)$  "https://grakn.ai/$1" [R=301,L]

# Canonicalisation
RewriteCond %{HTTP_HOST} ^grakn\.ai [NC]
RewriteRule ^index.html$  "https://grakn.ai/" [R=301,L]

# Redirect old links
RedirectMatch "^/pages/api-reference/(.*)" "/pages/documentation/api-reference/api-reference.html"
Redirect "/pages/documentation/the-basics/quickstart-tutorial.html" "/pages/documentation/get-started/quickstart-tutorial.html"
# REST API docs
RedirectMatch "^/pages/rest-api/(.*)/index.html" "/pages/rest-api/$1/engine-apis.html"

# Redirect for Grakn release archive
Redirect /download/latest "https://github.com/graknlabs/grakn/releases/download/v0.12.0/grakn-dist-0.12.0.zip"
Redirect /download "https://github.com/graknlabs/grakn/releases/"
Redirect /docs "/pages/index.html"
Redirect /overview "/pages/overview/index.html"
Redirect /install "/pages/documentation/get-started/setup-guide.html"
Redirect /2016-year-in-review "https://blog.grakn.ai/grakn-2016-year-in-review-e30b66adece3"
Redirect /blog/2016-year-in-review "https://blog.grakn.ai/grakn-2016-year-in-review-e30b66adece3"
Redirect /blog/janus-launch "https://blog.grakn.ai/janus-launch-22be6ac3b197"
Redirect /blog/award "https://blog.grakn.ai/cambridge-computer-lab-ring-product-of-the-year-2017-goes-to-grakn-ai-d0d7c5ba9f55"
Redirect /blog/biograkn "https://blog.grakn.ai/a-knowledge-graph-based-semantic-database-for-biomedical-sciences-167154319a0a"
Redirect /blog/hypergraphs "https://blog.grakn.ai/modelling-data-with-hypergraphs-edff1e12edf0"
Redirect /blog/2017-spring "https://blog.grakn.ai/grakn-ai-2017-spring-round-up-26c10c84e13e"

RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^([^\.]+)$ $1.html [NC,L]
