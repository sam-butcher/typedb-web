<h2 id="match-queries">Match Queries</h2>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">match</span>
<span class="err">$</span><span class="n">x</span> <span class="n">isa</span> <span class="n">pokemon</span><span class="p">,</span> <span class="n">id</span> <span class="nv">"Pikachu"</span><span class="p">;</span>
<span class="p">(</span><span class="n">pokemon</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="k">type</span> <span class="err">$</span><span class="n">x</span><span class="p">,</span> <span class="err">$</span><span class="n">y</span><span class="p">);</span>
</code></pre>
</div>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">qb</span><span class="o">.</span><span class="na">match</span><span class="o">(</span>
    <span class="n">var</span><span class="o">(</span><span class="s">"x"</span><span class="o">).</span><span class="na">isa</span><span class="o">(</span><span class="s">"pokemon"</span><span class="o">).</span><span class="na">id</span><span class="o">(</span><span class="s">"Pikachu"</span><span class="o">),</span>
    <span class="n">var</span><span class="o">().</span><span class="na">rel</span><span class="o">(</span><span class="s">"pokemon-with-type"</span><span class="o">,</span> <span class="s">"x"</span><span class="o">).</span><span class="na">rel</span><span class="o">(</span><span class="s">"y"</span><span class="o">)</span>
<span class="o">);</span>
</code></pre>
</div>

<p>A match query will search the graph for any subgraphs that match the given
<a href="#variable-patterns">patterns</a>. A result is produced for each match found,
containing any variables in the query. The results of the query can be modified
with various <a href="#modifiers">modifiers</a>.</p>

<h2 id="variable-patterns">Variable Patterns</h2>

<p>A pattern is a pattern to match in the graph. Patterns can be combined into a
disjunction (‘or’) and grouped together with curly braces. Patterns are
separated by semicolons, each pattern is independent of the others.</p>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">match</span>
<span class="err">$</span><span class="n">x</span> <span class="n">isa</span> <span class="n">pokemon</span><span class="p">;</span>
<span class="err">{</span>
  <span class="err">$</span><span class="n">x</span> <span class="n">id</span> <span class="nv">"Mew"</span>
<span class="err">}</span> <span class="k">or</span> <span class="err">{</span>
  <span class="p">(</span><span class="err">$</span><span class="n">x</span><span class="p">,</span> <span class="err">$</span><span class="n">y</span><span class="p">);</span>
  <span class="err">$</span><span class="n">y</span> <span class="n">isa</span> <span class="n">pokemon</span><span class="o">-</span><span class="k">type</span><span class="p">,</span> <span class="n">id</span> <span class="nv">"water"</span><span class="p">;</span>
<span class="err">}</span>
</code></pre>
</div>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">qb</span><span class="o">.</span><span class="na">match</span><span class="o">(</span>
  <span class="n">var</span><span class="o">(</span><span class="s">"x"</span><span class="o">).</span><span class="na">isa</span><span class="o">(</span><span class="s">"pokemon"</span><span class="o">),</span>
  <span class="n">or</span><span class="o">(</span>
    <span class="n">var</span><span class="o">(</span><span class="s">"x"</span><span class="o">).</span><span class="na">id</span><span class="o">(</span><span class="s">"Mew"</span><span class="o">),</span>
    <span class="n">and</span><span class="o">(</span>
      <span class="n">var</span><span class="o">().</span><span class="na">rel</span><span class="o">(</span><span class="s">"x"</span><span class="o">).</span><span class="na">rel</span><span class="o">(</span><span class="s">"y"</span><span class="o">),</span>
      <span class="n">var</span><span class="o">(</span><span class="s">"y"</span><span class="o">).</span><span class="na">isa</span><span class="o">(</span><span class="s">"pokemon-type"</span><span class="o">).</span><span class="na">id</span><span class="o">(</span><span class="s">"water"</span><span class="o">)</span>
    <span class="o">)</span>
  <span class="o">)</span>
<span class="o">);</span>
</code></pre>
</div>

<p>A variable pattern is a pattern describing <a href="#properties">properties</a> of a
particular concept. The variable pattern can optionally be bound to a variable
or an ID.</p>

<h2 id="properties">Properties</h2>

<h3 id="isa">isa</h3>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">match</span> <span class="err">$</span><span class="n">x</span> <span class="n">isa</span> <span class="n">pokemon</span>
</code></pre>
</div>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">qb</span><span class="o">.</span><span class="na">match</span><span class="o">(</span><span class="n">var</span><span class="o">(</span><span class="s">"x"</span><span class="o">).</span><span class="na">isa</span><span class="o">(</span><span class="s">"pokemon"</span><span class="o">));</span>
</code></pre>
</div>

<p>Match instances that have the given type.</p>

<h3 id="id">id</h3>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">match</span> <span class="err">$</span><span class="n">x</span> <span class="n">id</span> <span class="nv">"Articuno"</span>
</code></pre>
</div>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">qb</span><span class="o">.</span><span class="na">match</span><span class="o">(</span><span class="n">var</span><span class="o">(</span><span class="s">"x"</span><span class="o">).</span><span class="na">id</span><span class="o">(</span><span class="s">"Articuno"</span><span class="o">));</span>
</code></pre>
</div>

<p>Match concepts that have an <code class="highlighter-rouge">id</code> which matches the <a href="#predicates">predicate</a>.</p>

<h3 id="value">value</h3>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">match</span> <span class="err">$</span><span class="n">x</span> <span class="n">value</span> <span class="k">contains</span> <span class="nv">"lightning"</span><span class="p">;</span>
</code></pre>
</div>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">static</span> <span class="n">io</span><span class="o">.</span><span class="na">mindmaps</span><span class="o">.</span><span class="na">graql</span><span class="o">.</span><span class="na">api</span><span class="o">.</span><span class="na">query</span><span class="o">.</span><span class="na">ValuePredicate</span><span class="o">.*;</span>

<span class="n">qb</span><span class="o">.</span><span class="na">match</span><span class="o">(</span><span class="n">var</span><span class="o">(</span><span class="s">"x"</span><span class="o">).</span><span class="na">value</span><span class="o">(</span><span class="n">contains</span><span class="o">(</span><span class="s">"lightning"</span><span class="o">)))</span>
</code></pre>
</div>

<p>Match concepts that have a <code class="highlighter-rouge">value</code>. If a <a href="#predicates">predicate</a> is provided,
the resource must match that predicate.</p>

<h3 id="has">has</h3>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">match</span> <span class="err">$</span><span class="n">x</span> <span class="n">has</span> <span class="n">pokedex</span><span class="o">-</span><span class="k">no</span> <span class="o">&lt;</span> <span class="mi">20</span>
</code></pre>
</div>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">static</span> <span class="n">io</span><span class="o">.</span><span class="na">mindmaps</span><span class="o">.</span><span class="na">graql</span><span class="o">.</span><span class="na">api</span><span class="o">.</span><span class="na">query</span><span class="o">.</span><span class="na">ValuePredicate</span><span class="o">.*;</span>

<span class="n">qb</span><span class="o">.</span><span class="na">match</span><span class="o">(</span><span class="n">var</span><span class="o">(</span><span class="s">"x"</span><span class="o">).</span><span class="na">has</span><span class="o">(</span><span class="s">"pokedex-no"</span><span class="o">,</span> <span class="n">lt</span><span class="o">(</span><span class="mi">20</span><span class="o">)));</span>
</code></pre>
</div>

<p>Match concepts that have a resource of <code class="highlighter-rouge">type</code>. If a <a href="#predicates">predicate</a> is
provided, the resource must match that predicate.</p>

<h3 id="relation">relation</h3>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">match</span>
<span class="err">$</span><span class="n">x</span> <span class="n">isa</span> <span class="n">pokemon</span><span class="p">;</span>
<span class="p">(</span><span class="n">ancestor</span> <span class="err">$</span><span class="n">x</span><span class="p">,</span> <span class="err">$</span><span class="n">y</span><span class="p">)</span>
</code></pre>
</div>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">qb</span><span class="o">.</span><span class="na">match</span><span class="o">(</span>
  <span class="n">var</span><span class="o">(</span><span class="s">"x"</span><span class="o">).</span><span class="na">isa</span><span class="o">(</span><span class="s">"pokemon"</span><span class="o">),</span>
  <span class="n">var</span><span class="o">().</span><span class="na">rel</span><span class="o">(</span><span class="s">"ancestor"</span><span class="o">,</span> <span class="s">"x"</span><span class="o">).</span><span class="na">rel</span><span class="o">(</span><span class="s">"y"</span><span class="o">)</span>
<span class="o">);</span>
</code></pre>
</div>

<p>Match concepts that are relations between the given variables. If a role type
is provided, the role player must be playing that role type.</p>

<h2 id="type-properties">Type Properties</h2>

<p>The following properties only apply to types.</p>

<h3 id="ako">ako</h3>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">match</span> <span class="err">$</span><span class="n">x</span> <span class="n">ako</span> <span class="k">type</span>
</code></pre>
</div>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">qb</span><span class="o">.</span><span class="na">match</span><span class="o">(</span><span class="n">var</span><span class="o">(</span><span class="s">"x"</span><span class="o">).</span><span class="na">ako</span><span class="o">(</span><span class="s">"type"</span><span class="o">))</span>
</code></pre>
</div>

<p>Match types that are a subclass of the given type.</p>

<h3 id="has-role">has-role</h3>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">match</span> <span class="n">evolution</span> <span class="n">has</span><span class="o">-</span><span class="k">role</span> <span class="err">$</span><span class="n">x</span>
</code></pre>
</div>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">qb</span><span class="o">.</span><span class="na">match</span><span class="o">(</span><span class="n">id</span><span class="o">(</span><span class="s">"evolution"</span><span class="o">).</span><span class="na">hasRole</span><span class="o">(</span><span class="n">var</span><span class="o">(</span><span class="s">"x"</span><span class="o">)));</span>
</code></pre>
</div>

<p>Match relation types that have the given role.</p>

<h3 id="plays-role">plays-role</h3>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">match</span> <span class="err">$</span><span class="n">x</span> <span class="n">plays</span><span class="o">-</span><span class="k">role</span> <span class="n">ancestor</span>
</code></pre>
</div>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">qb</span><span class="o">.</span><span class="na">match</span><span class="o">(</span><span class="n">var</span><span class="o">(</span><span class="s">"x"</span><span class="o">).</span><span class="na">playsRole</span><span class="o">(</span><span class="s">"ancestor"</span><span class="o">));</span>
</code></pre>
</div>

<p>Match concept types that play the given role.</p>

<h2 id="predicates">Predicates</h2>

<p>A predicate is a boolean function applied to values.</p>

<p>If a concept doesn’t have a value, all predicates are considered false.</p>

<h3 id="comparators">Comparators</h3>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">match</span> <span class="err">$</span><span class="n">x</span> <span class="n">has</span> <span class="n">height</span> <span class="o">=</span> <span class="mi">19</span><span class="p">,</span> <span class="n">has</span> <span class="n">weight</span> <span class="o">&gt;</span> <span class="mi">1500</span>
</code></pre>
</div>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">static</span> <span class="n">io</span><span class="o">.</span><span class="na">mindmaps</span><span class="o">.</span><span class="na">graql</span><span class="o">.</span><span class="na">api</span><span class="o">.</span><span class="na">query</span><span class="o">.</span><span class="na">ValuePredicate</span><span class="o">.*;</span>

<span class="n">qb</span><span class="o">.</span><span class="na">match</span><span class="o">(</span><span class="n">var</span><span class="o">(</span><span class="s">"x"</span><span class="o">).</span><span class="na">has</span><span class="o">(</span><span class="s">"height"</span><span class="o">,</span> <span class="mi">19</span><span class="o">).</span><span class="na">has</span><span class="o">(</span><span class="s">"weight"</span><span class="o">,</span> <span class="n">gt</span><span class="o">(</span><span class="mi">1500</span><span class="o">)));</span>
</code></pre>
</div>

<p>There are several standard comparators, <code class="highlighter-rouge">=</code>, <code class="highlighter-rouge">!=</code>, <code class="highlighter-rouge">&gt;</code>, <code class="highlighter-rouge">&gt;=</code>, <code class="highlighter-rouge">&lt;</code> and <code class="highlighter-rouge">&lt;=</code>. For
longs and doubles, these sort by value. Strings are ordered lexicographically.</p>

<h3 id="contains">Contains</h3>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">match</span> <span class="err">$</span><span class="n">x</span> <span class="n">has</span> <span class="n">description</span> <span class="k">contains</span> <span class="nv">"underground"</span>
<span class="k">select</span> <span class="err">$</span><span class="n">x</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">has</span> <span class="n">description</span><span class="p">)</span>
</code></pre>
</div>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">static</span> <span class="n">io</span><span class="o">.</span><span class="na">mindmaps</span><span class="o">.</span><span class="na">graql</span><span class="o">.</span><span class="na">api</span><span class="o">.</span><span class="na">query</span><span class="o">.</span><span class="na">ValuePredicate</span><span class="o">.*;</span>

<span class="n">qb</span><span class="o">.</span><span class="na">match</span><span class="o">(</span><span class="n">var</span><span class="o">(</span><span class="s">"x"</span><span class="o">).</span><span class="na">has</span><span class="o">(</span><span class="s">"description"</span><span class="o">,</span> <span class="n">contains</span><span class="o">(</span><span class="s">"underground"</span><span class="o">)));</span>
</code></pre>
</div>

<p>Asks if the given string is a substring.</p>

<h3 id="regex">Regex</h3>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">match</span> <span class="err">$</span><span class="n">x</span> <span class="n">value</span> <span class="o">/</span><span class="p">.</span><span class="o">*</span><span class="p">(</span><span class="n">fast</span><span class="o">|</span><span class="n">quick</span><span class="p">).</span><span class="o">*/</span>
</code></pre>
</div>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">static</span> <span class="n">io</span><span class="o">.</span><span class="na">mindmaps</span><span class="o">.</span><span class="na">graql</span><span class="o">.</span><span class="na">api</span><span class="o">.</span><span class="na">query</span><span class="o">.</span><span class="na">ValuePredicate</span><span class="o">.*;</span>

<span class="n">qb</span><span class="o">.</span><span class="na">match</span><span class="o">(</span><span class="n">var</span><span class="o">(</span><span class="s">"x"</span><span class="o">).</span><span class="na">value</span><span class="o">(</span><span class="n">regex</span><span class="o">(</span><span class="s">".*(fast|quick).*"</span><span class="o">)));</span>
</code></pre>
</div>

<p>Checks if the value matches a regular expression. This match is across the
entire string, so if you want to match something within a string, you must
surround the expression with <code class="highlighter-rouge">.*</code>.</p>

<h3 id="and-and-or">And and Or</h3>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">match</span> <span class="err">$</span><span class="n">x</span> <span class="n">has</span> <span class="n">weight</span> <span class="o">&gt;</span><span class="mi">20</span> <span class="k">and</span> <span class="o">&lt;</span><span class="mi">30</span>
</code></pre>
</div>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">static</span> <span class="n">io</span><span class="o">.</span><span class="na">mindmaps</span><span class="o">.</span><span class="na">graql</span><span class="o">.</span><span class="na">api</span><span class="o">.</span><span class="na">query</span><span class="o">.</span><span class="na">ValuePredicate</span><span class="o">.*;</span>

<span class="n">qb</span><span class="o">.</span><span class="na">match</span><span class="o">(</span><span class="n">var</span><span class="o">(</span><span class="s">"x"</span><span class="o">).</span><span class="na">has</span><span class="o">(</span><span class="s">"weight"</span><span class="o">,</span> <span class="n">gt</span><span class="o">(</span><span class="mi">20</span><span class="o">).</span><span class="na">and</span><span class="o">(</span><span class="n">lt</span><span class="o">(</span><span class="mi">30</span><span class="o">))));</span>
</code></pre>
</div>

<p><code class="highlighter-rouge">and</code> and <code class="highlighter-rouge">or</code> allows combining predicates using boolean logic.</p>

<h2 id="modifiers">Modifiers</h2>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">match</span> <span class="err">$</span><span class="n">x</span> <span class="n">isa</span> <span class="n">pokemon</span>
<span class="k">select</span> <span class="err">$</span><span class="n">x</span><span class="p">(</span><span class="n">has</span> <span class="n">pokedex</span><span class="o">-</span><span class="k">no</span><span class="p">,</span> <span class="n">id</span><span class="p">)</span>
<span class="k">limit</span> <span class="mi">30</span><span class="p">,</span> <span class="k">offset</span> <span class="mi">10</span><span class="p">,</span> <span class="k">distinct</span><span class="p">,</span> <span class="k">order</span> <span class="k">by</span> <span class="err">$</span><span class="n">x</span><span class="p">(</span><span class="n">has</span> <span class="n">pokedex</span><span class="o">-</span><span class="k">no</span><span class="p">)</span> <span class="k">asc</span>
</code></pre>
</div>
<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">qb</span><span class="o">.</span><span class="na">match</span><span class="o">(</span><span class="n">var</span><span class="o">(</span><span class="s">"x"</span><span class="o">).</span><span class="na">isa</span><span class="o">(</span><span class="s">"pokemon"</span><span class="o">))</span>
    <span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">"x"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">limit</span><span class="o">(</span><span class="mi">30</span><span class="o">)</span>
    <span class="o">.</span><span class="na">offset</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
    <span class="o">.</span><span class="na">distinct</span><span class="o">()</span>
    <span class="o">.</span><span class="na">orderBy</span><span class="o">(</span><span class="s">"x"</span><span class="o">,</span> <span class="s">"pokedex-no"</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
</code></pre>
</div>

<h3 id="limit">limit</h3>
<p>Limit the query to the given number of results.</p>

<h3 id="offset">offset</h3>
<p>Offset the query by the given number of results.</p>

<h3 id="distinct">distinct</h3>
<p>Remove any duplicate results.</p>

<h3 id="order">order</h3>
<p>Order the results by the given variable’s degree. If a type is provided, order
by the resource of that type on that concept. Order is ascending by default.</p>

<h3 id="select">select</h3>

<p>Indicates which variables to include in the results as well as optionally some
<a href="#getters">getters</a>, e.g. <code class="highlighter-rouge">$x(id)</code>. If no getters are provided, the query will
get the <a href="#section-id">id</a>, <a href="#section-value">value</a> and <a href="#section-isa">isa</a> from
each result.</p>

<h4 id="getters">Getters</h4>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">match</span> <span class="err">$</span><span class="n">x</span> <span class="n">isa</span> <span class="n">pokemon</span>
<span class="k">select</span> <span class="err">$</span><span class="n">x</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">has</span> <span class="n">pokedex</span><span class="o">-</span><span class="k">no</span><span class="p">,</span> <span class="n">has</span> <span class="n">description</span><span class="p">)</span>
</code></pre>
</div>

<p>A getter indicates a property to get from a variable. Getters are supported in
the Graql shell, but are not supported in <a href="java-graql.md">Java Graql</a>.</p>

<h5 id="isa-1">isa</h5>
<p>Get the type of a concept.</p>

<h5 id="id-1">id</h5>
<p>Get the <code class="highlighter-rouge">id</code> of a concept.</p>

<h5 id="value-1">value</h5>
<p>Get the <code class="highlighter-rouge">value</code> of a concept.</p>

<h5 id="has-1">has</h5>
<p>Get all resources of the given type on this concept.</p>
