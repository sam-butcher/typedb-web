<h2 id="java-graql">Java Graql</h2>

<p>As well as the Graql shell, users can also construct and execute Graql queries
programmatically in Java.</p>

<p>Add the following to your <code class="highlighter-rouge">pom.xml</code>:</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>io.mindmaps.graql<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>graql-core<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>0.2.1<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre>
</div>

<h2 id="querybuilder">QueryBuilder</h2>

<p>The <code class="highlighter-rouge">QueryBuilder</code> class is how you begin building Graql queries.</p>

<p><code class="highlighter-rouge">QueryBuilder</code> and <code class="highlighter-rouge">ValuePredicate</code> contains several useful static methods such
as <code class="highlighter-rouge">var</code> and <code class="highlighter-rouge">eq</code>, so itâ€™s recommended that you use a static import:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">io.mindmaps.graql.api.query.QueryBuilder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">io</span><span class="o">.</span><span class="na">mindmaps</span><span class="o">.</span><span class="na">graql</span><span class="o">.</span><span class="na">api</span><span class="o">.</span><span class="na">query</span><span class="o">.</span><span class="na">QueryBuilder</span><span class="o">.*;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">io</span><span class="o">.</span><span class="na">mindmaps</span><span class="o">.</span><span class="na">graql</span><span class="o">.</span><span class="na">api</span><span class="o">.</span><span class="na">query</span><span class="o">.</span><span class="na">ValuePredicate</span><span class="o">.*;</span>
</code></pre>
</div>

<p>A <code class="highlighter-rouge">QueryBuilder</code> is constructed by providing a Mindmaps Graph:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">MindmapsGraph</span> <span class="n">graph</span> <span class="o">=</span> <span class="n">TinkerGraphFactory</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">getGraph</span><span class="o">();</span>
<span class="n">QueryBuilder</span> <span class="n">qb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QueryBuilder</span><span class="o">(</span><span class="n">graph</span><span class="o">);</span>
</code></pre>
</div>

<p>The <code class="highlighter-rouge">QueryBuilder</code> class provides methods for building <code class="highlighter-rouge">match</code>, <code class="highlighter-rouge">ask</code>,
<code class="highlighter-rouge">insert</code> and <code class="highlighter-rouge">delete</code> queries.</p>

<h2 id="match-queries">Match Queries</h2>

<p>Match queries are constructed using the <code class="highlighter-rouge">match</code> method and include all
modifiers:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">MatchQuery</span> <span class="n">tallPokemon</span> <span class="o">=</span> <span class="n">qb</span><span class="o">.</span><span class="na">match</span><span class="o">(</span><span class="n">var</span><span class="o">(</span><span class="s">"x"</span><span class="o">).</span><span class="na">isa</span><span class="o">(</span><span class="s">"pokemon"</span><span class="o">).</span><span class="na">has</span><span class="o">(</span><span class="s">"height"</span><span class="o">,</span> <span class="n">gt</span><span class="o">(</span><span class="mi">10</span><span class="o">))).</span><span class="na">limit</span><span class="o">(</span><span class="mi">50</span><span class="o">);</span>
</code></pre>
</div>

<p><code class="highlighter-rouge">MatchQuery</code> is <code class="highlighter-rouge">Iterable</code> and has a <code class="highlighter-rouge">stream</code> method. Each result is a
<code class="highlighter-rouge">Map&lt;String, Concept&gt;</code>, where the keys are the variable names in the query.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="k">for</span> <span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Concept</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">:</span> <span class="n">tallPokemon</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"x"</span><span class="o">).</span><span class="na">getValue</span><span class="o">());</span>
<span class="o">}</span>

<span class="n">tallPokemon</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
  <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">r</span> <span class="o">-&gt;</span> <span class="n">r</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"x"</span><span class="o">))</span>
  <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">Concept:</span><span class="o">:</span><span class="n">getValue</span><span class="o">)</span>
  <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
</code></pre>
</div>

<h2 id="ask-queries">Ask Queries</h2>

<p>Ask queries execute as soon as <code class="highlighter-rouge">execute()</code> is called:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="k">if</span> <span class="o">(</span><span class="n">qb</span><span class="o">.</span><span class="na">ask</span><span class="o">(</span><span class="n">var</span><span class="o">().</span><span class="na">isa</span><span class="o">(</span><span class="s">"pokemon-type"</span><span class="o">).</span><span class="na">value</span><span class="o">(</span><span class="s">"dragon"</span><span class="o">)))</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Dragons are real!"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
</div>

<h2 id="insert-queries">Insert Queries</h2>

<p>Insert queries execute as soon as <code class="highlighter-rouge">execute()</code> is called:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">InsertQuery</span> <span class="n">addPichu</span> <span class="o">=</span> <span class="n">qb</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">var</span><span class="o">().</span><span class="na">id</span><span class="o">(</span><span class="s">"Pichu"</span><span class="o">).</span><span class="na">isa</span><span class="o">(</span><span class="s">"pokemon"</span><span class="o">));</span>

<span class="n">addPichu</span><span class="o">.</span><span class="na">execute</span><span class="o">();</span>

<span class="c1">// Make everything dragons!</span>
<span class="n">qb</span><span class="o">.</span><span class="na">match</span><span class="o">(</span>
  <span class="n">var</span><span class="o">(</span><span class="s">"x"</span><span class="o">).</span><span class="na">isa</span><span class="o">(</span><span class="s">"pokemon"</span><span class="o">)</span>
<span class="o">).</span><span class="na">insert</span><span class="o">(</span>
  <span class="n">var</span><span class="o">().</span><span class="na">isa</span><span class="o">(</span><span class="s">"has-type"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">rel</span><span class="o">(</span><span class="s">"pokemon-with-type"</span><span class="o">,</span> <span class="s">"x"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">rel</span><span class="o">(</span><span class="s">"type-of-pokemon"</span><span class="o">,</span> <span class="n">var</span><span class="o">().</span><span class="na">id</span><span class="o">(</span><span class="s">"dragon"</span><span class="o">))</span>
<span class="o">).</span><span class="na">execute</span><span class="o">();</span>
</code></pre>
</div>

<h2 id="delete-queries">Delete Queries</h2>

<p>Delete queries are executed when <code class="highlighter-rouge">execute()</code> is called:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">qb</span><span class="o">.</span><span class="na">match</span><span class="o">(</span><span class="n">var</span><span class="o">(</span><span class="s">"x"</span><span class="o">).</span><span class="na">id</span><span class="o">(</span><span class="s">"Pichu"</span><span class="o">)).</span><span class="na">delete</span><span class="o">(</span><span class="s">"x"</span><span class="o">).</span><span class="na">execute</span><span class="o">();</span>
</code></pre>
</div>

<h2 id="query-parser">Query Parser</h2>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>io.mindmaps.graql<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>graql-parser<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>0.2.1<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre>
</div>

<p>The <code class="highlighter-rouge">QueryParser</code> allows the user to parse Graql query strings into Java Graql
objects:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">QueryParser</span> <span class="n">parser</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QueryParser</span><span class="o">(</span><span class="n">graph</span><span class="o">);</span>

<span class="n">parser</span><span class="o">.</span><span class="na">parseMatchQuery</span><span class="o">(</span><span class="s">"match $x isa pokemon"</span><span class="o">).</span><span class="na">getMatchQuery</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="s">"x"</span><span class="o">).</span><span class="na">forEach</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>

<span class="k">if</span> <span class="o">(</span><span class="n">parser</span><span class="o">.</span><span class="na">parseAskQuery</span><span class="o">(</span><span class="s">"match water isa pokemon-type ask"</span><span class="o">).</span><span class="na">execute</span><span class="o">())</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Water is a pokemon type!"</span><span class="o">);</span>
<span class="o">}</span>

<span class="n">parser</span><span class="o">.</span><span class="na">parseInsertQuery</span><span class="o">(</span><span class="s">"insert id 'pichu' isa pokemon"</span><span class="o">).</span><span class="na">execute</span><span class="o">();</span>

<span class="n">parser</span><span class="o">.</span><span class="na">parseDeleteQuery</span><span class="o">(</span><span class="s">"match $x isa pokemon delete $x"</span><span class="o">);</span>
</code></pre>
</div>
